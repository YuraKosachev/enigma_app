# Enigma machine
## Настройки машины

### Роторы:

| Ротор | Начальные позиция |
|--|--|
|**FAST**|**JGDQOXUSCAMIFRVTPNEWKBLZYH**|
|**MEDIUM**|**NTZPSFBOKMWRCJDIVLAEYUXHGQ**|
|**SLOW**|**JVIUBHTCDYAKEQZPOSGXNRMWFL**|
### Рефлектор:


| Элемент | Значения |
|--|--|
| **REFLECTOR** | **{ 'A','Y' },{ 'B','R' },{ 'C','U' },{ 'D','H' },{ 'E','Q' },{ 'F','S' },{ 'G','L' },{ 'I','P' },{ 'J','X' },{ 'K','N' },{ 'M','O' },{ 'T','Z' },{ 'V','W' }**|


> :exclamation: :exclamation: Обратите внимание, что вращение роторов происходит против часовой стрелки (на примере FAST ротора -> **H** займет позицию **J** и вся строка сдвинется на позицию вниз) и полный цикл вращения считается тогда, когда текущее положение букв ротора = начальному положению (На примере FAST ротора - когда буква **J** займет нулевую позицию строки).

### Дневные ключи шифрования
**Дневные позиции роторов** - это стартовые позиции дня для роторов (Необходимо "перематывать" ротор на установленую в настройках позицию согласно приходящей в метод encode дате)
> :exclamation: :exclamation: Общая структура машины шифрования и принцип работы указан внизу..

| День | Дневная позиция роторов ***Slow-Medium-Fast*** | Настройки SWAP Board |
|-|-|-|
|1|'S', 'H', 'U'|'{"E":"R","Q":"G","D":"P","L":"S","I":"T",,"X":"B","Y":"J"}'|
|2|'H', 'D', 'W'|'{"X":"L","B":"G","I":"Y","V":"N","O":"U","R":"F","A":"T"}'|
|3|'X', 'B', 'G'|'{"Y":"L"}'|
|4|'Y', 'K', 'W'|'{"A":"D","E":"V","L":"S","B":"R","Q":"X","H":"G","W":"K"}'|
|5|'H', 'H', 'S'||
|6|'T', 'J', 'R'|'{"I":"E","S":"F","M":"X","N":"D","U":"H"}'|
|7|'A', 'O', 'N'|'{"K":"N","F":"B","E":"A","R":"T","J":"L","P":"D","C":"U","G":"H","M":"S"}'|
|8|'M', 'T', 'G'|'{"N":"L","E":"X","I":"F","R":"C","O":"D","T":"H","A":"P"}'|
|9|'G', 'U', 'Q'|'{"D":"J"}'|
|10|'I', 'S', 'F'|'{"S":"E","L":"C","K":"M","B":"J","A":"H","O":"R","T":"G","F":"Y","Q":"X","U":"D","V":"I"}'|
|11|'D', 'P', 'M'|'{"F":"K","A":"V","G":"B","I":"E"}'|
|12|'S', 'R', 'H'|'{"T":"K","R":"I","Y":"V","H":"G","M":"Q","U":"B","S":"J"}'|
|13|'R', 'V', 'U'|'{"K":"T","M":"E","C":"V","X":"H"}'|
|14|'S', 'T', 'U'|'{"U":"V","C":"W","Y":"F","G":"A","S":"P","T":"R","D":"K","L":"B","J":"X"}'|
|15|'C', 'G', 'N'|'{"S":"B","F":"H","K":"J","V":"P","C":"O","E":"L","Y":"M"}'|
|16|'U', 'A', 'X'|'{"N":"O","F":"X","Q":"W","R":"D","P":"E"}'|
|17|'K', 'O', 'U'|'{"H":"W","R":"L","U":"B","F":"M","E":"X"}'|
|18|'I', 'S', 'Y'|'{"F":"B","G":"R","Q":"D","L":"N","H":"I","X":"A","J":"O"}'|
|19|'Q', 'J', 'V'|'{"X":"V","M":"F","W":"I","P":"L"}'|
|20|'S', 'G', 'K'|'{"Y":"W","X":"D","A":"E"}'|
|21|'B', 'Y', 'C'|'{"Q":"O","K":"G","N":"Y","U":"S","T":"E","R":"H","M":"A"}'|
|22|'V', 'C', 'V'|'{"O":"J","P":"C","E":"U","Q":"A","H":"W","G":"Y","T":"R"}'|
|23|'G', 'K', 'V'|'{"H":"O","L":"P","J":"D","V":"N","X":"F","Y":"K","T":"S","Q":"C"}'|
|24|'H', 'N', 'C'|'{"N":"G","L":"P","Q":"V","Y":"S","B":"A","D":"E"}'|
|25|'T', 'S', 'U'|'{"O":"Q","K":"V","L":"U","S":"D","W":"R"}'|
|26|'U', 'K', 'T'|'{"E":"B","Q":"F","V":"O","K":"M","L":"H","C":"W"}'|
|27|'T', 'M', 'F'|'{"S":"J","C":"F","H":"Y","E":"P","V":"W","N":"Q","D":"O"}'|
|28|'J', 'X', 'P'|'{"N":"I","S":"T","U":"L","O":"C","A":"B"}'|
|29|'R', 'T', 'V'|'{"J":"Q","D":"F","M":"B","E":"U","V":"X","K":"Y","A":"W"}'|
|30|'C', 'S', 'J'|'{"T":"V","C":"L","D":"Y","F":"G","E":"I","J":"M","U":"A"}'|
|31|'Q', 'C', 'W'|'{"J":"X","E":"D","G":"I","U":"C","S":"W","T":"M","Y":"V"}'|

## Принцип работы
Для упрощения понимания работы шифровальной машины «Энигма» предположим, что у нас существует алфавит всего из восьми символов = {A, B, C, D, E, F, G, H}. Из этого следует, что сами роторы, рефлектор и соответственно коммутаторы ограничены этим же размером. Первое, что нам необходимо сделать — это спроектировать рефлектор и роторы под 8-ми символьный алфавит, как самую базовую основу шифровальной машины «Энигма».

Предположим, что рефлектор имеет следующие связи символов между собой: A=C, B=E, D=H, F=G. Если бы количество символов алфавита было бы нечётным, то шифровальную машину «Энигма» нельзя было бы спроектировать таким образом, каким её проектировали изначально авторы, потому как возникала бы возможность шифрования одного и того же символа самим собой за счёт оставшейся связи рефлектора X=X. Визуально, рефлектор можно изобразить в виде следующей схемы.

![e7f3e20fe4cfbcc1e50821ea68f8f49a.png](readme_img%2Fe7f3e20fe4cfbcc1e50821ea68f8f49a.png)
\* Рефлектор с принимаемым (до равно) и выходным (после равно) значениями.

Работа рефлектора крайне проста. Если на вход поступает символ A, то рефлектор возвратит нам символ C, если поступает символ H, то рефлектор вернёт символ D и т.д.

Далее, нам необходимо точно таким же образом составить роторы. В отличие от рефлектора, где значения всегда статичны, в роторах значения постоянно меняются. Можно сказать, что каждый ротор представляет собой два диска, где один находится всегда в статичном положении, а другой вращается либо при нажатии символов, либо при совершении полного круга одного из роторов. Для начала создадим один ротор и проведём его к рефлектору. Результат будет выглядить следующим образом.

![ff34c26f5de24274289bbc9f1bdca777.png](readme_img%2Fff34c26f5de24274289bbc9f1bdca777.png)
\* Ротор соединённый с рефлектором.

Левая часть ротора для нас будет являться статичной, в то время как правая часть динамична (P.S. наверное лучше было сделать правую часть всё же статичной, а левую динамичной для простоты понимания ввода символов в ротор, тем не менее, механику и получаемый результат такая инверсия никак не изменяет). Ротор — это полиалфавитный шифр, который меняет свой ключ шифрования после каждого введённого символа. Так например, в нашем случае, если мы будем шифровать комбинацию символов AAA, то мы будем получать на выходе ротора результат равный GHA (БЕЗ УЧЁТА РЕФЛЕКТОРА), с условием того, что динамическая часть ротора будет вращаться всегда вниз после нажатого символа.

Теперь, если мы также попытаемся зашифровать комбинацию символов AAA, но пропустим её не только через один ротор, но и последовательно через рефлектор, то получим уже следующий результат: CBE. Суть алгоритма можно представить на примере шифрования первого символа A. Выходом ротора для A будет символ G, символ G попадает на рефлектор и отражается в символ F (потому как таковой является парным), после уже рефлектор подаёт на вход ротору (но в обратном направлении) символ F, который на выходе ротора преобразуется в символ C. Таким образом, символ A шифруется символом C.

На этом же примере мы можем легко проверить, что символ A никогда не зашифруется самим собой, потому как у рефлектора не существует парного символа к самому себе. Для того, чтобы это проверить, достаточно зашифровать 8 раз символ A. На выходе мы будем получать следующий результат: CBEHGBDF (тут главное не ошибиться в количестве сдвигов ротора). Далее, если мы продолжим шифровать символ A, то придём к цикличности шифруемой последовательности, потому как у одного ротора существует только 8 возможных позиций.

Теперь же давайте добавим ещё два ротора с другими вариациями, поставим их последовательно, и проведём их композицию также к рефлектору.

![06ee9d6d86946c5f16daf6707588fbc9.png](readme_img%2F06ee9d6d86946c5f16daf6707588fbc9.png)
\* Полная цепь роторов проведённых к рефлектору

Теперь, предположим, что я начинаю шифровать какой-либо символ, тогда по механике «Энигмы» сдвинется только самый ближний ротор к входу, то-есть правый. Как только он совершит свой полный цикл вращения, то на одну позицию повернётся следующий за ним ротор, то-есть средний. Как только средний ротор совершит свой полный цикл, то на одну позицию повернётся следующий за ним ротор, то-есть левый. Такое действие можно продолжать ещё очень долго, но исходя из истории, остановимся только на трёх роторах.

На вышеописанном примере процесс шифрования лучше уже показывать визуально, т.к. система связей значительно усложняется. Так например, если я буду шифровать три раза символ A, то он станет равен сначала символу C, потом символу G, а потом символу E. Это можно показать на следующих схемах.
![00ab2570ffa834c2ace551a2cd3b3aa7.png](readme_img%2F00ab2570ffa834c2ace551a2cd3b3aa7.png)
\* Первый раунд шифрования символа A

![8837f32926d3e959c651ff5268463e9c.png](readme_img%2F8837f32926d3e959c651ff5268463e9c.png)
\*Второй раунд шифрования символа A

![f0989e97639547412c6ab54a0a312ed8.png](readme_img%2Ff0989e97639547412c6ab54a0a312ed8.png)
\* Третий раунд шифрования символа A

Теперь, когда мы разобрались с работой роторов и рефлектора, мы можем усложнить работу «Энигмы» коммутаторами и коммутационной панелью соответственно. Коммутаторы начинают использоваться сразу после ввода символа и перед выходом. В аналогии с современной симметричной криптографией такой механизм можно представить как отбеливающую функцию.

![fab83fded57c3dc9de5652cd8dd85508.png](readme_img%2Ffab83fded57c3dc9de5652cd8dd85508.png)
\* Полная схема шифровальной машины «Энигма»
